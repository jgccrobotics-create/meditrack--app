<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>MediTrack - Smart Medicine Scheduler</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <!-- QR Code -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        :root {
            --primary: #4a6fa5; --secondary: #6b8cbc; --accent: #ff7e5f;
            --light: #f8f9fa; --dark: #343a40; --success: #28a745;
            --warning: #ffc107; --danger: #dc3545;
        }
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh; padding: 20px; color: var(--dark);
        }
        .container { max-width: 1200px; margin: 0 auto; }

        header { text-align: center; padding: 20px 0; margin-bottom: 20px; }
        .logo { display:flex; align-items:center; justify-content:center; gap:15px; margin-bottom:10px;}
        .logo i { font-size:2.5rem; color:var(--primary); }
        h1 { color:var(--primary); font-size:2.2rem; margin-bottom:5px; }
        .subtitle { color:var(--secondary); font-size:1.1rem; }

        .top-cards { display: grid; grid-template-columns: 1fr; gap: 18px; margin-bottom: 22px; }
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px; }
        @media (max-width: 768px) { .dashboard { grid-template-columns: 1fr; } .top-cards { grid-template-columns: 1fr; } }

        .card {
            background: white; border-radius: 15px; box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            padding: 20px; margin-bottom: 20px; transition: transform 0.25s ease;
        }
        .card:hover { transform: translateY(-5px); }
        .card-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:18px; padding-bottom:10px; border-bottom:1px solid #eee; }
        .card-title { font-size:1.2rem; color:var(--primary); display:flex; align-items:center; gap:10px; }

        .form-group { margin-bottom: 16px; }
        label { display:block; margin-bottom:8px; font-weight:600; color:var(--dark); }
        input, select { width:100%; padding:10px 12px; border:1px solid #ddd; border-radius:8px; font-size:1rem; }
        input:focus, select:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 4px rgba(74,111,165,0.08); }

        .btn { display:inline-block; padding:10px 18px; background:var(--primary); color:white; border:none; border-radius:8px; font-weight:600; cursor:pointer; }
        .btn:hover { transform: translateY(-2px); background: var(--secondary); }
        .btn-accent { background: var(--accent); }
        .btn-refresh { background: var(--success); }
        .btn-secondary { background: #6c757d; color: #fff; }

        .pulse-rate { text-align:center; padding: 18px; }
        .pulse-value { font-size: 3rem; font-weight:700; color:var(--primary); margin:12px 0; }
        .pulse-status { font-size:1rem; color:var(--secondary); margin-bottom:10px; }
        .schedule-list { list-style:none; padding:0; }
        .schedule-item { display:flex; justify-content:space-between; align-items:center; padding:12px; margin-bottom:12px; background:#f8f9fa; border-radius:10px; border-left:5px solid var(--primary); }
        .time-badge { display:inline-block; padding:4px 10px; border-radius:20px; font-size:0.8rem; font-weight:600; margin-right:8px; }
        .time-morning { background:#fff3cd; color:#856404; }
        .time-afternoon { background:#d1ecf1; color:#0c5460; }
        .time-night { background:#e2e3e5; color:#383d41; }

        .qr-section { text-align:center; padding:16px; background:#f8f9fa; border-radius:10px; margin-top:12px; }
        .qr-code-container { display:inline-block; padding:12px; background:white; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.08); }

        .firebase-status { position: fixed; bottom: 20px; right: 20px; padding: 10px 15px; background: var(--success); color: white; border-radius: 20px; font-size: 0.9rem; display: flex; align-items: center; gap:8px; box-shadow: 0 3px 10px rgba(0,0,0,0.18);}
        .status-indicator { display:inline-block; width:12px; height:12px; border-radius:50%; margin-right:8px; }
        .status-normal { background:var(--success); } .status-elevated { background:var(--warning);} .status-high { background:var(--danger);}

        .temp-grid { display:flex; gap:18px; align-items:center; justify-content:space-between; }
        .temp-value-large { font-size: 2.6rem; font-weight:800; color:var(--accent); }
        .hum-value { font-size:1.2rem; color:var(--primary); font-weight:700; }
        @media (max-width:700px) { .temp-grid { flex-direction:column; align-items:flex-start; } }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <div class="logo">
                <i class="fas fa-pills"></i>
                <h1>MediTrack</h1>
            </div>
            <p class="subtitle">Smart Medicine Scheduler - Live on GitHub Pages</p>
        </header>

        <!-- Temperature & Humidity -->
        <div class="top-cards">
            <div class="card" id="dht-card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-thermometer-half"></i> Live Temperature & Humidity</h2>
                    <button id="refresh-temp-btn" class="btn btn-refresh"><i class="fas fa-sync-alt"></i> Refresh</button>
                </div>

                <div class="temp-grid">
                    <div>
                        <div>Temperature</div>
                        <div class="temp-value-large" id="temp-value">-- Â°C</div>
                        <div id="temp-last-updated">Last updated: --</div>
                    </div>

                    <div style="text-align:right;">
                        <div>Humidity</div>
                        <div class="hum-value" id="hum-value">-- %</div>
                        <div id="hum-last-updated">Last updated: --</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div class="dashboard">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-calendar-plus"></i> Schedule Medicine</h2>
                </div>

                <form id="schedule-form">
                    <div class="form-group">
                        <label>Medicine Name</label>
                        <input type="text" id="medicine-name" required>
                    </div>
                    <div class="form-group">
                        <label>Time Settings</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div>
                                <label>Time of Day</label>
                                <select id="medicine-period" required>
                                    <option value="">Select</option>
                                    <option value="morning">ðŸŒ… Morning</option>
                                    <option value="afternoon">ðŸŒž Afternoon</option>
                                    <option value="night">ðŸŒ™ Night</option>
                                </select>
                            </div>
                            <div>
                                <label>Exact Time</label>
                                <input type="time" id="medicine-time" required>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Frequency</label>
                        <select id="medicine-frequency" required>
                            <option value="">Select</option>
                            <option value="once">Once</option>
                            <option value="daily">Daily</option>
                            <option value="weekly">Weekly</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-accent"><i class="fas fa-plus"></i> Add Schedule</button>
                </form>

                <!-- QR -->
                <div class="qr-section">
                    <h3 class="card-title"><i class="fas fa-qrcode"></i> Share Your Live App</h3>
                    <div id="qrcode"></div>
                    <p id="current-url"></p>
                </div>
            </div>

            <!-- Pulse -->
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title"><i class="fas fa-heartbeat"></i> Live Pulse Monitor</h2>
                    <button id="refresh-pulse-btn" class="btn btn-refresh"><i class="fas fa-sync-alt"></i></button>
                </div>
                <div class="pulse-rate">
                    <div class="pulse-value" id="pulse-value">--</div>
                    <div class="pulse-status" id="pulse-status">Waiting...</div>
                    <div id="last-updated">Last updated: --</div>
                </div>
            </div>
        </div>

        <!-- Schedule List -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title"><i class="fas fa-list-alt"></i> Active Medicine Schedules</h2>
                <button id="refresh-schedules-btn" class="btn btn-refresh"><i class="fas fa-sync-alt"></i></button>
            </div>
            <ul class="schedule-list" id="schedule-list"></ul>
        </div>
    </div>

    <div class="firebase-status" id="firebase-status">
        <i class="fas fa-database"></i>
        <span>Firebase Connected</span>
    </div>

    <!-- FIREBASE JS -->
    <script>
        /* ---------------------------- SIMPLE FIREBASE ----------------------------- */
        const firebaseConfig = {
            databaseURL: "https://test-60a8c-default-rtdb.asia-southeast1.firebasedatabase.app/"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        /* --------------------------- CONNECTION STATUS ---------------------------- */
        db.ref(".info/connected").on("value", snap => {
            const el = document.getElementById("firebase-status");
            if (snap.val()) {
                el.style.background = "#28a745";
                el.innerHTML = '<i class="fas fa-database"></i> Firebase Connected';
            } else {
                el.style.background = "#dc3545";
                el.innerHTML = '<i class="fas fa-database"></i> Firebase Offline';
            }
        });

        /* --------------------------- READ TEMP & HUM ------------------------------ */
        function listenTempHum() {
            db.ref("meditrack/temperature").on("value", s => {
                if (s.exists()) {
                    document.getElementById("temp-value").textContent = s.val() + " Â°C";
                    document.getElementById("temp-last-updated").textContent =
                        "Updated: " + new Date().toLocaleTimeString();
                }
            });

            db.ref("meditrack/humidity").on("value", s => {
                if (s.exists()) {
                    document.getElementById("hum-value").textContent = s.val() + " %";
                    document.getElementById("hum-last-updated").textContent =
                        "Updated: " + new Date().toLocaleTimeString();
                }
            });
        }

        /* ------------------------------ READ PULSE ------------------------------- */
        function listenPulse() {
            db.ref("meditrack/pulse").on("value", s => {
                if (!s.exists()) return;
                const pulse = s.val();
                document.getElementById("pulse-value").textContent = pulse;
                document.getElementById("pulse-status").textContent = "OK";
                document.getElementById("last-updated").textContent =
                    "Updated: " + new Date().toLocaleTimeString();
            });
        }

        /* ------------------------ WRITE NEXT MEDICINE ---------------------------- */
        function saveSchedule(name, period, time, frequency) {
            db.ref("meditrack/nextMedicine").set({
                name: name,
                period: period,
                time: time,
                frequency: frequency
            });
        }

        /* ------------------------- LOAD NEXT MEDICINE ---------------------------- */
        function loadSchedule() {
            db.ref("meditrack/nextMedicine").on("value", snap => {
                const list = document.getElementById("schedule-list");
                list.innerHTML = "";

                if (!snap.exists()) {
                    list.innerHTML = "<li style='padding:20px;text-align:center;color:#666;'>No schedules</li>";
                    return;
                }

                const d = snap.val();
                list.innerHTML = `
                    <li class="schedule-item">
                        <div style="flex-grow:1;">
                            <div style="font-weight:bold; font-size:1.2rem;">${d.name}</div>
                            <div>${d.period} | ${d.time}</div>
                            <div>${d.frequency}</div>
                        </div>
                        <button onclick="deleteSchedule()" style="border:none;background:none;color:#666;">
                            <i class="fas fa-trash"></i>
                        </button>
                    </li>`;
            });
        }

        function deleteSchedule() {
            db.ref("meditrack/nextMedicine").remove();
        }

        /* ----------------------- SCHEDULE FORM SUBMIT ---------------------------- */
        document.getElementById("schedule-form").addEventListener("submit", e => {
            e.preventDefault();
            saveSchedule(
                document.getElementById("medicine-name").value,
                document.getElementById("medicine-period").value,
                document.getElementById("medicine-time").value,
                document.getElementById("medicine-frequency").value
            );
            alert("Schedule added!");
        });

        /* ----------------------- QR Code ---------------------------------------- */
        function generateQRCode() {
            const url = window.location.href;
            document.getElementById("current-url").textContent = url;
            QRCode.toCanvas(document.getElementById("qrcode"), url, { width: 200 });
        }

        /* ---------------------------- INIT -------------------------------------- */
        function initApp() {
            listenTempHum();
            listenPulse();
            loadSchedule();
            generateQRCode();
        }

        window.onload = initApp;
    </script>

    <!-- Chatbase (unchanged) -->
    <script>
    (function(){if(!window.chatbase||window.chatbase("getState")!=="initialized"){window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}})}const onLoad=function(){const script=document.createElement("script");script.src="https://www.chatbase.co/embed.min.js";script.id="Tb8r3uXWe2hnpCTqUpPyP";script.domain="www.chatbase.co";document.body.appendChild(script)};if(document.readyState==="complete"){onLoad()}else{window.addEventListener("load",onLoad)}})();
    </script>

</body>
</html>
